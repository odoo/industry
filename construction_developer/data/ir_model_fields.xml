<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record model="ir.model.fields" id="field_sale_order_line_x_delivered_progress">
        <field name="ttype">float</field>
        <field name="field_description">Delivered Progress</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="name">x_delivered_progress</field>
        <field name="depends">qty_delivered,product_uom_qty</field>
        <field name="compute"><![CDATA[
for sol in self: sol['x_delivered_progress'] = 100 * (sol.qty_delivered / sol.product_uom_qty) if sol.product_uom_qty else False
        ]]></field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_quantity_increment">
        <field name="ttype">float</field>
        <field name="field_description">Quantity Increment</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="name">x_quantity_increment</field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_progress_increment">
        <field name="ttype">float</field>
        <field name="field_description">Progress Increment</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="name">x_progress_increment</field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_current_progress">
        <field name="ttype">float</field>
        <field name="field_description">Current Progress</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="name">x_current_progress</field>
        <field name="depends">x_delivered_progress,x_progress_increment</field>
        <field name="store" eval="False"/>
        <field name="compute"><![CDATA[
for sol in self: sol['x_current_progress'] = sol.x_delivered_progress + 100 * sol.x_progress_increment
        ]]></field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_service_policy">
        <field name="name">x_service_policy</field>
        <field name="field_description">Product Service Policy</field>
        <field name="ttype">selection</field>
        <field name="related">product_id.service_policy</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="store" eval="False"/>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_is_undeliverable">
        <field name="name">x_is_undeliverable</field>
        <field name="field_description">Is an undeliverable Product</field>
        <field name="ttype">boolean</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="compute"><![CDATA[
for sol in self: sol['x_is_undeliverable'] = not sol.display_type and not (sol.is_service and sol.x_service_policy == 'delivered_manual')
        ]]></field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_is_deliverable">
        <field name="name">x_is_deliverable</field>
        <field name="field_description">Is a deliverable Product</field>
        <field name="ttype">boolean</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="compute"><![CDATA[
for sol in self: sol['x_is_deliverable'] = not sol.display_type and sol.is_service and sol.x_service_policy == 'delivered_manual'
        ]]></field>
    </record>
    <record model="ir.model.fields" id="field_sale_order_line_x_display_button">
        <field name="name">x_display_button</field>
        <field name="field_description">Display the section/subsection button</field>
        <field name="ttype">boolean</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="compute"><![CDATA[
for record in self: record['x_display_button'] = record.display_type in ['line_section', 'line_subsection'] and any(child.x_is_deliverable for child in record.order_id.order_line if record.id in [child.parent_id.id, child.parent_id.parent_id.id])
]]></field>
    </record>

<!-- 
    Remarks: New Models
-->

<!-- Remark Category -->
    <record model="ir.model.fields" id="field_x_remark_category_x_name">
        <field name="model_id" ref="model_x_remark_category"/>
        <field name="ttype">char</field>
        <field name="name">x_name</field>
        <field name="field_description">Name</field>
        <field name="required" eval="True"/>
    </record>
    <record model="ir.model.fields" id="field_x_remark_category_x_color">
        <field name="model_id" ref="model_x_remark_category"/>
        <field name="ttype">integer</field>
        <field name="name">x_color</field>
        <field name="field_description">Color</field>
    </record>

<!-- Remark (is a project task) -->
    <record model="ir.model.fields" id="field_x_remark_x_is_remark">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">boolean</field>
        <field name="name">x_is_remark</field>
        <field name="field_description">Is Remark</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_date">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">date</field>
        <field name="name">x_date</field>
        <field name="field_description">Date</field>
        <field name="tracking">1</field>
        <field name="compute"><![CDATA[
for record in self: record['x_date'] = record['x_date'] or datetime.datetime.today().date()
]]></field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_reference">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">char</field>
        <field name="name">x_reference</field>
        <field name="field_description">Reference</field>
        <field name="depends">project_id</field>
        <field name="tracking">1</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_location">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">char</field>
        <field name="name">x_location</field>
        <field name="field_description">Location</field>
        <field name="tracking">1</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_category">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">many2many</field>
        <field name="relation">x_remark_category</field>
        <field name="name">x_remark_category_ids</field>
        <field name="field_description">Category</field>
        <field name="tracking">1</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_event_id">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">many2one</field>
        <field name="relation">calendar.event</field>
        <field name="on_delete" eval="False"/>
        <field name="name">x_event_id</field>
        <field name="field_description">Event</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_project_update_id">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">many2one</field>
        <field name="relation">project.update</field>
        <field name="on_delete" eval="False"/>
        <field name="name">x_update_id</field>
        <field name="field_description">Project Update</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_owner_id">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">many2one</field>
        <field name="relation">res.partner</field>
        <field name="on_delete" eval="False"/>
        <field name="name">x_owner_id</field>
        <field name="field_description">Owner</field>
        <field name="tracking">1</field>
    </record>
    <record model="ir.model.fields" id="field_x_remark_x_stage_id">
        <field name="model_id" ref="project.model_project_task"/>
        <field name="ttype">many2one</field>
        <field name="relation">project.task.type</field>
        <field name="on_delete" eval="False"/>
        <field name="name">x_stage_id</field>
        <field name="field_description">Remark Stage</field>
        <field name="tracking">1</field>
        <field name="group_expand" eval="True"/>
        <field name="domain">[('x_is_remark_stage', '=', True)]</field>
    </record>

<!-- 
    Remarks: External Models
-->
<!-- project.task.type -->
    <record model="ir.model.fields" id="field_project_task_type_x_is_remark_stage">
        <field name="model_id" ref="project.model_project_task_type"/>
        <field name="ttype">boolean</field>
        <field name="name">x_is_remark_stage</field>
        <field name="field_description">Is Remark Stage</field>
    </record>
<!-- calendar.event -->
    <record model="ir.model.fields" id="field_event_x_project_id">
        <field name="model_id" ref="calendar.model_calendar_event"/>
        <field name="ttype">many2one</field>
        <field name="relation">project.project</field>
        <field name="name">x_project_id</field>
        <field name="field_description">Project</field>
    </record>
    <record model="ir.model.fields" id="field_event_x_remark_ids">
        <field name="model_id" ref="calendar.model_calendar_event"/>
        <field name="ttype">one2many</field>
        <field name="relation">project.task</field>
        <field name="relation_field">x_event_id</field>
        <field name="name">x_remark_ids</field>
        <field name="field_description">Remarks</field>
    </record>
<!-- project.project -->
    <record model="ir.model.fields" id="field_project_x_event_ids">
        <field name="model_id" ref="project.model_project_project"/>
        <field name="ttype">one2many</field>
        <field name="relation">calendar.event</field>
        <field name="relation_field">x_project_id</field>
        <field name="name">x_event_ids</field>
        <field name="field_description">Events</field>
    </record>
    <record model="ir.model.fields" id="field_project_x_remark_ids">
        <field name="model_id" ref="project.model_project_project"/>
        <field name="ttype">one2many</field>
        <field name="relation">project.task</field>
        <field name="relation_field">project_id</field>
        <field name="name">x_remark_ids</field>
        <field name="field_description">Remarks</field>
    </record>
<!-- project.update -->
    <record model="ir.model.fields" id="field_project_update_x_remark_ids">
        <field name="model_id" ref="project.model_project_update"/>
        <field name="ttype">one2many</field>
        <field name="relation">project.task</field>
        <field name="relation_field">x_update_id</field>
        <field name="name">x_remark_ids</field>
        <field name="field_description">Remarks</field>
    </record>
</odoo>
