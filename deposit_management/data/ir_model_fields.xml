<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="field_aut_production" model="ir.model.fields">
        <field name="name">x_auto_production</field>
        <field name="field_description">Auto-production</field>
        <field name="ttype">boolean</field>
        <field name="model_id" ref="mrp.model_mrp_bom"/>
    </record>
    <record id="field_quantity_by_deposit_product" model="ir.model.fields">
        <field name="name">x_quantity_by_deposit_product</field>
        <field name="field_description">Contains</field>
        <field name="ttype">integer</field>
        <field name="help">When filled in, an automated BoM is setup to automatically break down this product in those components. Leave second field empty if this product is the smallest unit.</field>
        <field name="model_id" ref="product.model_product_template"/>
    </record>
    <record id="field_parent_product_bom" model="ir.model.fields">
        <field name="name">x_parent_product</field>
        <field name="field_description">Parent product</field>
        <field name="ttype">many2one</field>
        <field name="model_id" ref="mrp.model_mrp_bom"/>
        <field name="relation">product.template</field>
    </record>
    <record id="field_parent_product_rr" model="ir.model.fields">
        <field name="name">x_parent_product</field>
        <field name="field_description">Parent product</field>
        <field name="ttype">many2one</field>
        <field name="model_id" ref="stock.model_stock_warehouse_orderpoint"/>
        <field name="relation">product.template</field>
    </record>
    <record id="x_is_a_deposit_category" model="ir.model.fields">
        <field name="name">x_is_a_deposit_category</field>
        <field name="field_description">Is a Deposit Category</field>
        <field name="help">Products assigned with this category are considered deposit products.</field>
        <field name="ttype">boolean</field>
        <field name="model_id" ref="product.model_product_category"/>
    </record>
    <record id="x_is_a_deposit" model="ir.model.fields">
        <field name="name">x_is_a_deposit</field>
        <field name="field_description">Is a deposit</field>
        <field name="ttype">boolean</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="related">categ_id.x_is_a_deposit_category</field>
        <field name="readonly" eval="True"/>
    </record>
    <record id="product_template_currency_symbol" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="field_description">Currency Symbol </field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_currency_symbol_deposit</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="depends">company_id</field>
        <field name="compute"><![CDATA[main_company = self.env['res.company']._get_main_company()
for template in self:
    template['x_currency_symbol_deposit'] = template.company_id.sudo().currency_id.symbol or main_company.currency_id.symbol
]]></field>
    </record>
    <record id="x_deposit_amount" model="ir.model.fields">
        <field name="name">x_deposit_amount</field>
        <field name="field_description">Deposit Amount</field>
        <field name="ttype">float</field>
        <field name="model_id" ref="product.model_product_template"/>
    </record>
    <record id="field_empty_deposit" model="ir.model.fields">
        <field name="name">x_deposit_product</field>
        <field name="field_description">By-Deposit</field>
        <field name="ttype">many2one</field>
        <field name="help">Deposit</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="relation">product.template</field>
        <field name="domain">[('x_is_a_deposit', '=', True)]</field>
    </record>
    <record id="field_unit_sale_product" model="ir.model.fields">
        <field name="name">x_unit_sale_product</field>
        <field name="field_description">Unit sale product</field>
        <field name="ttype">many2one</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="relation">product.template</field>
        <field name="copied" eval="False"/>
    </record>
    <record id="field_deposit_product_1" model="ir.model.fields">
        <field name="name">x_deposit_product_1</field>
        <field name="field_description">Total Deposits</field>
        <field name="ttype">many2one</field>
        <field name="help">Product capturing the total deposits due on sale</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="relation">product.template</field>
        <field name="domain">[('x_is_a_deposit', '=', True)]</field>
    </record>
    <record id="field_deposit_categ_id" model="ir.model.fields">
        <field name="name">x_deposit_categ_id</field>
        <field name="field_description">Available Deposit Category</field>
        <field name="ttype">many2one</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="relation">product.category</field>
        <field name="compute"><![CDATA[
self['x_deposit_categ_id'] = self.env['product.category'].search([('x_is_a_deposit_category', '=', True)], limit=1)
]]></field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
    </record>
    <record id="account_tax_group_is_deposit" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="field_description">Is Deposit</field>
        <field name="model_id" ref="account.model_account_tax_group"/>
        <field name="name">x_is_deposit</field>
    </record>
    <record id="account_tax_deposit_field" model="ir.model.fields">
        <field name="name">x_is_deposit</field>
        <field name="model_id" ref="account.model_account_tax"/>
        <field name="related">tax_group_id.x_is_deposit</field>
        <field name="ttype">boolean</field>
        <field name="readonly" eval="True"/>
    </record>
    <record id="sale_order_line_total_deposits_field" model="ir.model.fields">
        <field name="name">x_total_deposits</field>
        <field name="field_description">Deposits</field>
        <field name="ttype">monetary</field>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="depends">product_uom_qty, tax_ids</field>
        <field name="compute"><![CDATA[for record in self:
        deposit = sum(tax.amount for tax in record.tax_ids if tax.x_is_deposit)
        record['x_total_deposits'] = deposit * record.product_uom_qty]]></field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="currency_field">currency_id</field>
    </record>
    <record id="sale_order_has_deposit_line_field" model="ir.model.fields">
        <field name="name">x_has_deposit_line</field>
        <field name="field_description">Has Deposit Line</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="ttype">boolean</field>
        <field name="depends">order_line.x_total_deposits</field>
        <field name="compute"><![CDATA[
for record in self:
    record['x_has_deposit_line'] = any(line.x_total_deposits for line in record.order_line)]]></field>
        <field name="store" eval="False"/>
    </record>
    <record id="account_move_line_total_deposits_field" model="ir.model.fields">
        <field name="name">x_total_deposits_account_move</field>
        <field name="field_description">Deposits</field>
        <field name="model_id" ref="account.model_account_move_line"/>
        <field name="ttype">monetary</field>
        <field name="depends">tax_ids, quantity</field>
        <field name="compute"><![CDATA[for record in self:
        deposit = sum(tax.amount for tax in record.tax_ids if tax.x_is_deposit)
        record['x_total_deposits_account_move'] = deposit * record.quantity]]></field>
        <field name="readonly" eval="True"/>
        <field name="currency_field">company_currency_id</field>
    </record>
    <record id="account_move_has_deposit_line_field" model="ir.model.fields">
        <field name="name">x_has_deposit_line</field>
        <field name="field_description">Has Deposit Line</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="ttype">boolean</field>
        <field name="depends">line_ids.x_total_deposits_account_move</field>
        <field name="compute"><![CDATA[
for record in self:
    record['x_has_deposit_line'] = any(line.x_total_deposits_account_move for line in record.line_ids)]]></field>
        <field name="store" eval="False"/>
    </record>
</odoo>
