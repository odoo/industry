<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_x_remark_form" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark.view.form</field>
        <field name="model">x_remark</field>
        <field name="type">form</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <form>
                <header/>
                <sheet string="Remarks">
                    <!-- <div class="oe_button_box" name="button_box" groups="base.group_user">
                        <button class="oe_stat_button" type="object" name="action_view_tasks" icon="fa-check">
                            <div class="o_field_widget o_stat_info">
                                <field name="label_tasks" readonly="1"/>
                                <span class="o_stat_value">
                                    <field name="closed_task_count"/> / <field name="task_count"/>
                                    (<field name="task_completion_percentage" widget="percentage" options="{'digits': [1, 0]}"/>)
                                </span>
                            </div>
                        </button>
                    </div> -->
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="d-flex w-100">
                            <field name="x_name" options="{'line_breaks': False}" widget="text" class="o_task_name text-truncate w-md-75 w-100 pe-2" placeholder="Remark Title..."/>
                        </h1>
                        <div class="d-flex justify-content-end align-items-center px-1">
                            <field name="x_priority" class="h3 pe-2" widget="priority_switch"/>
                        </div>
                        <div class="d-flex justify-content-end o_state_container">
                            <field name="x_state" widget="project_remark_state_selection" class="o_task_state_widget" />
                        </div>
                    </div>
                    <group>
                        <group>
                            <field name="x_date" widget="date"/>
                            <field name="x_project_id"/>
                            <field name="x_event_id" readonly="True" invisible="x_update_id or not (x_update_id and x_event_id)"/>
                            <field name="x_update_id" readonly="True" invisible="x_event_id or not (x_update_id and x_event_id)"/>
                            <field name="x_reference" readonly="True"/>
                            <field name="x_description" type="html" options="{'collaborative': false, 'resizable': false}" placeholder="Add details about this remark..."/>
                        </group>
                        <group>
                            <field name="x_location"/>
                            <field name="x_remark_category_ids" widget="many2many_tags" options="{'color_field': 'x_color'}"/>
                            <field name="x_due_date" decoration-danger="x_due_date and x_due_date &lt; current_date" decoration-bf="x_due_date and x_due_date &lt; current_date"/>
                            <field name="x_partner_id"/>
                        </group>
                        <group colspan="2" name="product_template_images" string="Remark Media">
                            <field
                                colspan="2"
                                name="x_remark_image_ids"
                                class="o_website_sale_image_list"
                                context="{'default_x_remark_id': id, 'default_name': x_name}"
                                mode="kanban"
                                add-label="Add Media"
                                nolabel="1"
                                widget="project_remark_x2_many_media_viewer"
                                options="{'convert_to_webp': True}"
                            />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_x_remark_list" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark.view.list</field>
        <field name="model">x_remark</field>
        <field name="type">list</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <list default_order="x_priority DESC,x_date">
                <field name="x_reference"/>
                <field name="x_date"/>
                <field name="x_priority" widget="priority" options="{'is_toggle_mode': false}"/>
                <field name="x_remark_category_ids" widget="many2many_tags" options="{'color_field': 'x_color'}"/>
                <field name="x_name"/>
                <field name="x_partner_id"/>
                <field name="x_due_date" widget="remaining_days"/>
                <field name="x_state" widget="project_remark_state_selection" class="o_task_state_widget"/>
            </list>
        </field>
    </record>

    <record id="view_x_remark_search" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark.view.search</field>
        <field name="model">x_remark</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <search string="Remark">
                <field string="Name &amp; Description" name="x_name" filter_domain="['|', ('x_name', 'like', self), ('x_description', 'like', self)]"/>
                <field string="Owner" name="x_partner_id" filter_domain="['|', ('x_partner_id.name', 'like', self), ('x_partner_id.user_ids.name', 'like', self)]"/>
                <field string="Category" name="x_remark_category_ids" filter_domain="[('x_remark_category_ids.x_name', 'like', self)]"/>
                <separator/>
                <filter string="My Remarks" name="my_remarks" domain="[('x_partner_id.user_ids', '=', uid)]"/>
                <filter string="Unassigned" name="unassigned" domain="[('x_partner_id', '=', False)]"/>
                <separator/>
                <filter string="Overdue" name="overdue" domain="[('x_due_date', '&lt;', 'today')]"/>
                <separator/>
                <filter string="Open" name="open_remarks" domain="[('x_state', 'in', ['01_in_progress','02_changes_requested', '03_approved'])]"/>
                <filter string="Closed" name="closed_remarks" domain="[('x_state', 'in', ['1_done','1_canceled'])]"/>
                <group>
                    <filter string="Owner" name="x_partner_id" context="{'group_by': 'x_partner_id'}" />
                    <filter string="Priority" name="x_priority" context="{'group_by': 'x_priority'}"/>
                    <filter string="Category" name="x_remark_category_ids" context="{'group_by': 'x_remark_category_ids'}"/>
                    <filter string="State" name="x_state" context="{'group_by': 'x_state'}"/>
                    <filter string="Project" name="x_project_id" context="{'group_by': 'x_project_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_x_remark_category_form" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark_category.view.form</field>
        <field name="model">x_remark_category</field>
        <field name="type">form</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <form>
                <header/>
                <sheet string="Remark Categories">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="d-flex w-100">
                            <field name="x_name" options="{'line_breaks': False}" widget="text" class="o_task_name text-truncate w-md-75 w-100 pe-2" placeholder="Category Name..."/>
                        </h1>
                    </div>
                    <group>
                        <field name="x_color" widget="color_picker"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_x_remark_category_list" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark_category.view.list</field>
        <field name="model">x_remark_category</field>
        <field name="type">list</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <list open_form_view="true">
                <field name="x_name"/>
            </list>
        </field>
    </record>


    <!-- This view should only be used from the product o2m because the required field product_tmpl_id has to be automatically set. -->
    <record id="view_x_remark_image_form" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark_image.view.form</field>
        <field name="model">x_remark_image</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <form string="Remark Images">
                <field name="x_sequence" invisible="1"/>
                <div class="row o_website_sale_image_modal">
                    <div class="col-md-6 col-xl-5">
                        <label for="x_name" string="Image Name"/>
                        <h2><field name="x_name" placeholder="Image Name"/></h2>
                        <label for="x_remark_id" string="Remark"/>
                        <field name="x_remark_id"/><br/>
                        <label for="x_video_url" string="Video URL"/><br/>
                        <field name="x_video_url"/><br/>
                    </div>
                    <div class="col-md-6 col-xl-7 text-center o_website_sale_image_modal_container">
                        <div class="row">
                            <div class="col">
                                <field name="x_image_1920" widget="image"/>
                            </div>
                            <div class="col" invisible="x_video_url in ['', False]">
                                <div class="o_video_container p-2">
                                    <span>Video Preview</span>
                                    <field name="x_embed_code" class="mt-2" widget="video_preview"/>
                                    <h4 class="o_invalid_warning text-muted text-center" invisible="x_embed_code">
                                        Please enter a valid Video URL.
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </field>
    </record>

    <record id="view_x_remark_image_form_kanban" model="ir.ui.view">
        <field name="name">construction.remarks.x_remark_image.view.kanban</field>
        <field name="model">x_remark_image</field>
        <field name="active" eval="True"/>
        <field name="arch" type="xml">
            <kanban string="Remark Images" default_order="x_sequence">
                <field name="x_remark_id" invisible="1"/>
                <field name="x_embed_code" invisible="1"/>
                <field name="x_video_url" invisible="1"/>
                <field name="x_can_image_1024_be_zoomed" invisible="1"/>
                <field name="x_sequence" widget="handle"/>
                <templates>
                    <t t-name="card" class="p-0 border-0">
                        <div class="card">
                            <div class="o_squared_image">
                                <field class="card-img-top" name="x_image_1920" widget="x2_many_image"/>
                            </div>
                            <div class="p-2 m-0 bg-200" t-attf-title="#{record.x_name.value}">
                                <field name="x_name" class="small fs-5 text-truncate d-block"/>
                            </div>
                            <!-- below 100 Kb: good -->
                            <t t-if="record.x_image_1920.raw_value.length &lt; 100*1000">
                                <t t-set="size_status" t-value="'text-bg-success'"/>
                                <t t-set="message">Acceptable file size</t>
                            </t>
                            <!-- below 1000 Kb: decent -->
                            <t t-elif="record.x_image_1920.raw_value.length &lt; 1000*1000">
                                <t t-set="size_status" t-value="'text-bg-warning'" />
                                <t t-set="message">Huge file size. The image should be optimized/reduced.</t>
                            </t>
                            <!-- above 1000 Kb: bad -->
                            <t t-else="1">
                                <t t-set="size_status" t-value="'text-bg-danger'"/>
                                <t t-set="message">Optimization required! Reduce the image size or increase your compression settings.</t>
                            </t>
                            <span t-attf-class="badge #{size_status} o_product_image_size" t-att-title="message"></span>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_calendar_event_form_inherit" model="ir.ui.view">
        <field name="name">calendar.event.form.inherit</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
        <field name="model">calendar.event</field>
        <field name="mode">extension</field>
        <field name="active" eval="True"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='page_invitations']" position="after" invisible="not location">
                <page name="remarks" string="Remarks">
                    <group class="mb-0">
                        <field name="x_project_id" class="mb-0"/>
                    </group>
                    <div class="g-col-sm-2">
                        <div class="o_horizontal_separator mt-2 mb-1 text-uppercase fw-bolder small">
                            Remarks
                        </div>
                    </div>
                    <field name="x_remark_ids" widget="one2many" nolabel="1" context="{'default_x_project_id': x_project_id}"/>
                </page>
            </xpath>
        </field>
    </record>

    <record id="project_update_view_form_inherit" model="ir.ui.view">
        <field name="name">project.update.view.form.inherit</field>
        <field name="inherit_id" ref="project.project_update_view_form"/>
        <field name="model">project.update</field>
        <field name="mode">extension</field>
        <field name="active" eval="True"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='description']" position="after">
                <page name="remarks" string="Remarks">
                    <field name="x_remark_ids" widget="one2many" nolabel="1" context="{'default_x_project_id': project_id}"/>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
