<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<record id="report_calendar_event_general_meeting_main_report" model="ir.ui.view">
		<field name="arch" type="xml">
			<t t-name="main_report">
				<t t-call="web.html_container">
					<t t-foreach="docs" t-as="doc">
						<t t-call="condominium.report_calendar_event_general_meeting_document" />
					</t>
				</t>
			</t>
		</field>
		<field name="key">condominium.report_calendar_event_general_meeting</field>
		<field name="active" eval="True" />
		<field name="name">condominium.report_calendar_event_general_meeting</field>
		<field name="type">qweb</field>
	</record>
	<record id="report_calendar_event_general_meeting_document" model="ir.ui.view">
		<field name="arch" type="xml">
			<t t-name="report_document">
				<t t-set="main_company" t-value="env.ref('base.main_company')" />
				<div t-attf-class="header o_company_#{main_company.id}_layout">
					<div class="d-flex justify-content-between mb-3">
						<div class="d-flex flex-column align-items-start">
							<img t-if="main_company.logo"
									class="o_company_logo_small mb-2"
									t-att-src="image_data_uri(main_company.logo)"
									alt="Logo"
									style="max-height: 60px;" />
							<div>
								<span t-field="main_company.partner_id"
											t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
								<t t-if="forced_vat">
									<div>
										<t t-out="main_company.country_id.vat_label or 'Tax ID'"/>:
										<span t-out="forced_vat"/>
									</div>
								</t>
							</div>
						</div>
						<div class="d-flex flex-column align-items-end">
							<img t-if="doc.x_condominium.logo"
									class="o_company_logo_small mb-2"
									t-att-src="image_data_uri(doc.x_condominium.logo)"
									alt="Logo"
									style="max-height: 60px;" />
							<div>
								<span t-field="doc.x_condominium.partner_id"
											t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
								<t t-if="forced_vat">
									<div>
										<t t-out="doc.x_condominium.country_id.vat_label or 'Tax ID'"/>:
										<span t-out="forced_vat"/>
									</div>
								</t>
							</div>
						</div>
					</div>
				</div>
				<div class="page">
					<div class="oe_structure" style="text-align: center;">
						<h2>
							<strong>
								GENERAL MEETING REPORT
							</strong>
						</h2>
						<h5 t-field="doc.start" />
						<h5 t-field="doc.location" />
					</div>
					<div class="oe_structure">
						<br />
						<strong>
							<span t-field="doc.x_attending_owners" /> owners </strong>were present and represented<strong>
							<span t-out="round(doc.x_attending_ratio * 100,1)" />%</strong> of the owner ratios.<br /><br />
					</div>
					<h5 class="oe_structure">Attending</h5>
					<t t-set="total_ratios" t-value="sum(doc.x_voting_key.x_ratio_ids.mapped('x_ratio'))" />
					<ul>
						<t t-foreach="doc.attendee_ids" t-as="attendee">
							<t t-if="attendee.x_attending and attendee.x_ratio &gt; 0">
								<li style="margin-bottom: 4px;">
									<strong><t t-out="attendee.partner_id.name" /></strong>, representing
									<span t-out="round(attendee.x_ratio / total_ratios * 100,1)" />% of the owner ratios
									<t t-if="attendee.x_delegating">and delegating</t>;
								</li>
							</t>
						</t>
					</ul>
					<br />
					<h5 class="oe_structure">Excused</h5>
					<ul>
						<t t-foreach="doc.attendee_ids" t-as="attendee">
							<t t-if="not attendee.x_attending and attendee.x_ratio &gt; 0">
								<li style="margin-bottom: 4px;">
									<strong><t t-out="attendee.partner_id.name" /></strong>, representing
									<span t-out="round(attendee.x_ratio / total_ratios * 100,1)" />
									% of the owner ratios
									<t t-if="attendee.x_delegating">
										<strong>and delegating</strong>
									</t>
									;
								</li>
							</t>
						</t>
					</ul>
					<br />
					<div class="oe_structure">
						<br />
					</div>
					<div class="oe_structure" style="text-align: center;">
						<h3><strong>Motions</strong></h3>
						<br />
					</div>
					<t t-set="motion_number" t-value="0" />
					<t t-foreach="doc.x_vote_ids" t-as="motion">
						<t t-set="motion_number" t-value="motion_number + 1" />
						<h4>
							<t t-out="motion_number" />. <t t-out="motion.x_name" />
						</h4>
						<p t-field="motion.x_notes" />
						<p>
							Votes (need <t t-out="motion.x_vote_criteria.x_name" />):
						</p>
						<t t-if="motion.x_abstention != 0">
							<ul>
								<li>
									<span>
										<strong style="color:grey;">
											Abstention:<t t-out="round(motion.x_abstention * 100,1)" />%
										</strong>
									</span>
									<t t-if="motion.x_abstention != 0 and motion.x_abstention != 1">
										<span style="color:grey;">
											<t t-foreach="motion.x_attendee_vote_ids" t-as="voter">
												<t t-if="voter.x_vote == 'Abstention'">
													<t t-out="voter.x_attendee.name" />,
												</t>
											</t>
										</span>
										<br />
									</t>
								</li>
							</ul>
						</t>
						<t t-if="motion.x_against != 0">
							<ul>
								<li>
									<span>
										<strong style="color:red;">
											Against: <t t-out="round(motion.x_against * 100,1)" />%
										</strong>
									</span>
									<t t-if="motion.x_against != 0 and motion.x_against != 1">
										<span style="color:grey;">
											<t t-foreach="motion.x_attendee_vote_ids" t-as="voter">
												<t t-if="voter.x_vote == 'Against'">
													<t t-out="voter.x_attendee.name" />,
												</t>
											</t>
										</span>
										<br />
									</t>
								</li>
							</ul>
						</t>
						<t t-if="motion.x_in_favor != 0">
							<ul>
								<li>
									<span>
										<strong style="color:green;">
											In favor: <t t-out="round(motion.x_in_favor * 100,1)" />%
										</strong>
									</span>
									<t t-if="motion.x_in_favor != 0 and motion.x_in_favor &lt; 0.999">
										<span style="color:grey;">
											<t t-foreach="motion.x_attendee_vote_ids" t-as="voter">
												<t t-if="voter.x_vote == 'In Favor'">
													<t t-out="voter.x_attendee.name" />,
												</t>
											</t>
										</span>
										<br />
									</t>
								</li>
							</ul>
						</t>
						<div class="oe_structure">
							<p>
								<br />
								<t t-if="motion.x_outcome">
									<strong>
										The motion is <t t-out="motion.x_outcome" />.
									</strong>
								</t>
								<t t-else="">
									<p>
										The motion is not submitted to vote.
									</p>
								</t>
								<br />
								<br />
							</p>
						</div>
					</t>
					<div class="oe_structure">
						<br />
					</div>
				</div>
			</t>
		</field>
		<field name="key">condominium.report_calendar_event_general_meeting_document</field>
		<field name="active" eval="True" />
		<field name="name">condominium.report_calendar_event_general_meeting_document</field>
		<field name="type">qweb</field>
	</record>
	<record id="report_calendar_event_general_meeting_agenda_main_report" model="ir.ui.view">
		<field name="arch" type="xml">
			<t t-name="main_report">
				<t t-call="web.html_container">
					<t t-foreach="docs" t-as="doc">
						<t t-call="condominium.report_calendar_event_general_meeting_agenda_document" />
					</t>
				</t>
			</t>
		</field>
		<field name="key">condominium.report_calendar_event_general_meeting_agenda</field>
		<field name="active" eval="True" />
		<field name="name">condominium.report_calendar_event_general_meeting_agenda</field>
		<field name="type">qweb</field>
	</record>
	<record id="report_calendar_event_general_meeting_agenda_document" model="ir.ui.view">
		<field name="arch" type="xml">
			<t t-name="report_document">
				<t t-set="main_company" t-value="env.ref('base.main_company')" />
				<div t-attf-class="header o_company_#{main_company.id}_layout">
					<div class="d-flex justify-content-between mb-3">
						<div class="d-flex flex-column align-items-start">
							<img t-if="main_company.logo"
									class="o_company_logo_small mb-2"
									t-att-src="image_data_uri(main_company.logo)"
									alt="Logo"
									style="max-height: 60px;" />
							<div>
								<span t-field="main_company.partner_id"
											t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
								<t t-if="forced_vat">
									<div>
										<t t-out="main_company.country_id.vat_label or 'Tax ID'"/>:
										<span t-out="forced_vat"/>
									</div>
								</t>
							</div>
						</div>
						<div class="d-flex flex-column align-items-end">
							<img t-if="doc.x_condominium.logo"
									class="o_company_logo_small mb-2"
									t-att-src="image_data_uri(doc.x_condominium.logo)"
									alt="Logo"
									style="max-height: 60px;" />
							<div>
								<span t-field="doc.x_condominium.partner_id"
											t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
								<t t-if="forced_vat">
									<div>
										<t t-out="doc.x_condominium.country_id.vat_label or 'Tax ID'"/>:
										<span t-out="forced_vat"/>
									</div>
								</t>
							</div>
						</div>
					</div>
				</div>
				<div class="page">
					<div class="oe_structure" style="text-align: center;">
						<h2>
							<strong>
								GENERAL MEETING AGENDA
							</strong>
						</h2>
						<h5 t-field="doc.start" />
						<h5 t-field="doc.location" />
						<br />
					</div>
					<h5 class="oe_structure">
						Expected attendees
					</h5>
					<t t-set="total_ratios" t-value="sum(doc.x_voting_key.x_ratio_ids.mapped('x_ratio')) " />
					<ul>
						<t t-foreach="doc.attendee_ids" t-as="attendee">
							<t t-if="attendee.x_ratio &gt; 0">
								<li style="margin-bottom: 4px;">
									<strong>
										<t t-out="attendee.partner_id.name" />
									</strong>
									, representing
									<span t-out="round(attendee.x_ratio / total_ratios * 100,1)" />
									% of the owner ratios;
								</li>
							</t>
						</t>
					</ul>
					<t t-set="motion_number" t-value="0" />
					<t t-foreach="doc.x_vote_ids" t-as="motion">
						<t t-set="motion_number" t-value="motion_number + 1" />
						<br />
						<h4>
							<t t-out="motion_number" />. <t t-out="motion.x_name" />
						</h4>
					</t>
					<div class="oe_structure">
						<br />
					</div>
				</div>
			</t>
		</field>
		<field name="key">condominium.report_calendar_event_general_meeting_agenda_document</field>
		<field name="active" eval="True" />
		<field name="name">condominium.report_calendar_event_general_meeting_agenda_document</field>
		<field name="type">qweb</field>
	</record>
</odoo>
