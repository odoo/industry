<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="ir_cron_request_contact_id_document" model="ir.cron">
        <field name="name">Accounting Firm: Request Contact Identity Document</field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
for contact in model.search([('x_id_expiration_date', '!=', False), ('x_id_expiration_date', '<', datetime.datetime.today().date() + dateutil.relativedelta.relativedelta(days=7))]):
    if not env['documents.document'].search_count([('partner_id', '=', contact.id), ('x_is_identity_document_request', '!=', False), ('attachment_id', '=', False)], limit=1):
        doc = env['documents.request_wizard'].create({
            "folder_id": env.ref('documents.document_inbox_folder').id,
            "res_id": contact.id,
            "res_model": env.context.get("default_res_model", False),
            "name": "Identity Document - " + contact.name,
            "requestee_id": contact.id,
            "partner_id": contact.id,
            "activity_date_deadline_range": 7,
            "activity_note": "Please provide your identity document for update.",
        }).request_document()
        doc['x_is_identity_document_request'] = True
        contact.message_post(body="Document request has been sent")
]]></field>
    </record>
</odoo>
