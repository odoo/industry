<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="ir_cron_update_dgi_state" model="ir.cron">
        <field name="name">Stock History-Create Daily Records</field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="nextcall" eval="datetime.today().date()+relativedelta(days=1,minutes=1)"/>
        <field name="model_id" ref="x_stock_history_model"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
for sq in env['stock.quant'].search([('location_id.usage', '=', 'internal')]):
    if sq.inventory_quantity_auto_apply <= 0.0: continue
    sh = env['x_stock_history'].create({
        'x_date': datetime.datetime.today().date(),
        'x_history_owner_id': sq.product_tmpl_id.x_owner_id.id,
        'x_location_id': sq.location_id.id,
        'x_history_fee_rate_id': sq.location_id.x_location_fee_rate_id.id,
        'x_product_id': sq.product_id.id,
        'x_package_id': sq.package_id.id,
        'x_stock_lot_id': sq.lot_id.id,
        'x_quantity': sq.inventory_quantity_auto_apply,
    })
    sh['x_package_type'] = sh.x_package_master_container_id.package_type_id.name
]]></field>
    </record>
</odoo>
