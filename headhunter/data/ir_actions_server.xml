<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="agreement_signature_actions" model="ir.actions.server">
        <field name="name">Agreement Signature</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="base_automation_id" ref="agreement_signature_automation"/>
        <field name="state">mail_post</field>
        <field name="template_id" ref="crm_signature_agreem"/>
    </record>
    <record id="agreement_signature_actions_2" model="ir.actions.server">
        <field name="name">Template Signature</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="base_automation_id" ref="agreement_signature_automation"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
for lead in records:
    sign_request = env['sign.request'].create({
        'template_id': env.ref('headhunter.sign_template_5').id,
        'reference': env.ref('headhunter.sign_template_5').display_name,
        'request_item_ids': [Command.create({
            'partner_id': lead.partner_id.id,
            'role_id': env.ref('headhunter.sign_item_role_customer').id,
        })],
    })
    sign_request.message_subscribe(partner_ids=env.ref('base.partner_admin').ids)
]]>
        </field>
    </record>
    <record id="contact_activity_actions" model="ir.actions.server">
        <field name="name">Contact activity</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="base_automation_id" ref="contact_activity_automation"/>
        <field name="state">next_activity</field>
        <field name="activity_type_id" ref="mail.mail_activity_data_call"/>
    </record>
    <record id="contact_applicant_actions" model="ir.actions.server">
        <field name="name">Contact Applicant</field>
        <field name="model_id" ref="hr_recruitment.model_hr_applicant"/>
        <field name="base_automation_id" ref="contact_applicant_automation"/>
        <field name="state">next_activity</field>
        <field name="activity_type_id" ref="mail.mail_activity_data_call"/>
    </record>
    <record id="todo_activity_server_action" model="ir.actions.server">
        <field name="name">Create To-Do</field>
        <field name="model_id" ref="hr_recruitment.model_hr_applicant"/>
        <field name="state">code</field>
        <field name="base_automation_id" ref="create_activity_on_talent_poll_automation"/>
        <field name="code"><![CDATA[
for record in records:
    env["mail.activity"].create(
        {
            "activity_type_id": env.ref("mail.mail_activity_data_todo").id,
            "summary": "Candidate is hired, Please update the availability",
            "res_model_id": env.ref("hr_recruitment.model_hr_applicant").id,
            "res_id": record.pool_applicant_id.id if record.pool_applicant_id else record.id,
            "user_id": record.user_id.id if record.user_id else record.create_uid.id,
            "date_deadline": datetime.date.today(),
        }
    )
    ]]></field>
    </record>
    <record id="ir_actions_server_view_sales_order" model="ir.actions.server">
        <field name="name">View Sales Order</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="hr.model_hr_job"/>
        <field name="code"><![CDATA[
    action = {
        'view_mode': 'form',
        'res_model': 'sale.order',
        'res_id': record.x_quotation_sales_order.id,
        'type': 'ir.actions.act_window',
    }
    ]]></field>
    </record>
    <record id="ir_actions_server_view_opportunity" model="ir.actions.server">
        <field name="name">View Opportunity</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="hr.model_hr_job"/>
        <field name="code"><![CDATA[
    action = {
        'view_mode': 'form',
        'res_model': 'crm.lead',
        'res_id': record.x_opportunity.id,
        'type': 'ir.actions.act_window',
    }
    ]]></field>
    </record>
    <record id="ir_actions_server_view_invoices" model="ir.actions.server">
        <field name="name">View Invoices</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="hr.model_hr_job"/>
        <field name="code"><![CDATA[
invoices = record.x_invoices
action = {
    'res_model': 'account.move',
    'type': 'ir.actions.act_window',
}
if len(invoices) == 1:
    action.update({
        'view_mode': 'form',
        'res_id': invoices.id,
    })
elif invoices:
    action.update({
        'view_mode': 'list,form',
        'domain': [('id', 'in', invoices.ids)],
    })
action
    ]]></field>
    </record>
    <record id="ir_actions_server_706" model="ir.actions.server">
        <field name="name">Execute Code</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="base_automation_id" ref="status_update_base_automation"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
for record in records:
    if record['x_status_bar'] == 'done':
        record['website_published'] = False
    if record['website_published'] and record['x_status_bar'] == 'draft':
        raise UserError("You cannot publish a Draft Job Position. Please set status to Open before publishing.")
    if record['x_status_bar'] == 'draft' and record.all_application_count > 0:
        raise UserError("You cannot set this job position back to Draft because applications already exist.")]]></field>
    </record>
    <record id="ir_actions_server_create_sale_order_from_job" model="ir.actions.server">
        <field name="name">Create sale order</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="hr.model_hr_job"/>
        <field name="code"><![CDATA[
action = {
    'view_mode': 'form',
    'type': 'ir.actions.act_window',
    'res_model': 'sale.order',
    'context': {
        'default_x_job_id': record.id,
    }
}]]></field>
    </record>
    <record id="ir_actions_server_link_to_job" model="ir.actions.server">
        <field name="name">Execute Code</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="base_automation_id" ref="base_automation_sale_linked_to_job_position"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[record.x_job_id.write({'x_quotation_sales_order': record.id})]]></field>
    </record>
    <record id="ir_actions_server_check_portal_access" model="ir.actions.server">
        <field name="name">Check Portal Access</field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="hr.model_hr_job"/>
        <field name="code"><![CDATA[
partner_ids = record.x_hiring_team_contact.ids if record.x_hiring_team_contact else []
action = env['portal.wizard'].with_context(default_partner_ids=partner_ids).action_open_wizard()
    ]]></field>
    </record>
    <record id="ir_actions_server_stage_update_for_cv" model="ir.actions.server">
        <field name="name">Execute Code</field>
        <field name="model_id" ref="hr_recruitment.model_hr_applicant"/>
        <field name="base_automation_id" ref="base_automation_to_check_cv_is_attached"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
if not record.x_is_shared_cv:
    raise UserError("No CV set on this Talent/applicant.")
    ]]></field>
    </record>
    <record id="ir_actions_server_712" model="ir.actions.server">
        <field name="code"><![CDATA[
if not (record.x_status_bar == 'open' and record.active and record.is_published):
    for job in record.x_similar_job_ids:
        if record.id in job.x_similar_job_ids.ids:
            job['x_similar_job_ids'] = [(3, record.id)]
else:
    for job in record.x_similar_job_ids:
        if record.id not in job.x_similar_job_ids.ids:
            job['x_similar_job_ids'] = [(4, record.id)]]]></field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="base_automation_id" ref="base_automation_sync_as_per_status"/>
        <field name="state">code</field>
        <field name="name">Execute Code</field>
  </record>
  <record id="ir_actions_server_713" model="ir.actions.server">
        <field name="code"><![CDATA[
for similar in record.x_similar_job_ids:
    if similar.x_status_bar == 'open' and similar.active and similar.is_published:
        if record.id not in similar.x_similar_job_ids.ids:
            similar['x_similar_job_ids'] = [(4, record.id)]]]></field>
        <field name="model_id" ref="hr.model_hr_job"/>
        <field name="base_automation_id" ref="base_automation_job_add"/>
        <field name="state">code</field>
        <field name="name">Execute Code</field>
        <field name="usage">base_automation</field>
  </record>
</odoo>
