<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="name_excise_category" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Name</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_name</field>
        <field name="required" eval="True"/>
        <field name="translate">standard</field>
    </record>
    <record id="active_excise_category" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Active</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_active</field>
    </record>
    <record id="sequence_excise_category" model="ir.model.fields">
        <field name="ttype">integer</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Sequence</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_sequence</field>
    </record>
    <record id="description_excise_category" model="ir.model.fields">
        <field name="ttype">text</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Description</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_description</field>
    </record>
    <record id="unit_excise_category" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Unit</field>
        <field name="model_id" ref="excise_category"/>
        <field name="relation">uom.uom</field>
        <field name="name">x_unit_id</field>
        <field name="required" eval="True"/>
        <field name="on_delete">restrict</field>
    </record>
    <record id="sales_tax_excise_category" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="field_description">Excise Sales Tax</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_sales_tax_id</field>
        <field name="relation">account.tax</field>
        <field name="on_delete">cascade</field>
    </record>
    <record id="purchase_tax_excise_category" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="field_description">Excise Purchase Tax</field>
        <field name="model_id" ref="excise_category"/>
        <field name="name">x_purchase_tax_id</field>
        <field name="relation">account.tax</field>
        <field name="on_delete">cascade</field>
    </record>
    <record id="product_template_excise_category" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Excise category</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_excise_category</field>
        <field name="relation">x_excise_category</field>
    </record>
    <record id="product_template_currency_symbol" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="field_description">Currency symbol</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_currency_symbol</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="depends">company_id</field>
        <field name="compute"><![CDATA[main_company = self.env['res.company']._get_main_company()
for template in self:
    template['x_currency_symbol'] = template.company_id.sudo().currency_id.symbol or main_company.currency_id.symbol
]]></field>
    </record>
    <record id="product_template_uom" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="related">x_excise_category.x_unit_id</field>
        <field name="relation">uom.uom</field>
        <field name="field_description">Excise unit</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_excise_unit</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
    </record>
    <record id="product_template_excise_amount" model="ir.model.fields">
        <field name="ttype">float</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Excise amount</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_excise_amount</field>
    </record>
    <record id="product_template_excise_quantity" model="ir.model.fields">
        <field name="ttype">float</field>
        <field name="field_description">Excise quantity</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_excise_quantity</field>
    </record>
    <record id="product_template_excise_description" model="ir.model.fields">
        <field name="ttype">text</field>
        <field name="related">x_excise_category.x_description</field>
        <field name="field_description">Excise description</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="name">x_excise_description</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
    </record>
    <record id="stock_warehouse_is_fiscal_deposit" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Is Fiscal Deposit</field>
        <field name="model_id" ref="stock.model_stock_warehouse"/>
        <field name="name">x_is_fiscal_deposit</field>
    </record>
    <record id="fiscal_position_is_fiscal_deposit" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Is Fiscal Deposit</field>
        <field name="model_id" ref="account.model_account_fiscal_position"/>
        <field name="name">x_is_fiscal_deposit</field>
    </record>
    <record id="account_tax_group_is_excise" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="field_description">Is Excise</field>
        <field name="model_id" ref="account.model_account_tax_group"/>
        <field name="name">x_is_excise</field>
    </record>
    <record id="account_tax_is_excise" model="ir.model.fields">
        <field name="ttype">boolean</field>
        <field name="field_description">Is Excise</field>
        <field name="model_id" ref="account.model_account_tax"/>
        <field name="name">x_is_excise</field>
        <field name="related">tax_group_id.x_is_excise</field>
        <field name="readonly" eval="True"/>
    </record>
    <record id="stock_move_fiscal_deposit_move" model="ir.model.fields">
      <field name="ttype">selection</field>
      <field name="depends">location_id,location_dest_id</field>
      <field name="field_description">Fiscal deposit move</field>
      <field name="model_id" ref="stock.model_stock_move"/>
      <field name="name">x_fiscal_deposit_move</field>
      <field name="readonly" eval="True"/>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_none" model="ir.model.fields.selection">
        <field name="name">None</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">none</field>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_entry" model="ir.model.fields.selection">
        <field name="name">Entry</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">entry</field>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_entry_fd" model="ir.model.fields.selection">
        <field name="name">Entry from FD</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">entry fd</field>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_entry_exit" model="ir.model.fields.selection">
        <field name="name">Exit</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">exit</field>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_exit_fd" model="ir.model.fields.selection">
        <field name="name">Exit to FD</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">exit fd</field>
    </record>
    <record id="stock_move_fiscal_deposit_move_selection_transfer" model="ir.model.fields.selection">
        <field name="name">Transfer</field>
        <field name="field_id" ref="stock_move_fiscal_deposit_move" />
        <field name="value">transfer</field>
    </record>
    <record id="stock_move_fiscal_deposit_move" model="ir.model.fields">
        <field name="compute"><![CDATA[for record in self:
    record['x_fiscal_deposit_move'] = "none"
    if record.location_id.usage == 'internal' and record.location_dest_id.usage == 'internal':
        if record.location_id.warehouse_id.x_is_fiscal_deposit and record.location_dest_id.warehouse_id.x_is_fiscal_deposit:
            record['x_fiscal_deposit_move'] = "transfer"
        elif record.location_id.warehouse_id.x_is_fiscal_deposit:
            record['x_fiscal_deposit_move'] = "exit"
        elif record.location_dest_id.warehouse_id.x_is_fiscal_deposit:
            record['x_fiscal_deposit_move'] = "entry"
    elif record.location_id.warehouse_id.x_is_fiscal_deposit:
        if record.picking_id.partner_id.property_account_position_id.x_is_fiscal_deposit:
            record['x_fiscal_deposit_move'] = "exit fd"
        else:
            record['x_fiscal_deposit_move'] = "exit"
    elif record.location_dest_id.warehouse_id.x_is_fiscal_deposit:
        if record.picking_id.partner_id.property_account_position_id.x_is_fiscal_deposit:
            record['x_fiscal_deposit_move'] = "entry fd"
        else:
            record['x_fiscal_deposit_move'] = "entry"
        ]]></field>
    </record>
    <record id="stock_move_currency" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="field_description">Currency</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="name">x_currency_id</field>
        <field name="related">product_id.currency_id</field>
        <field name="relation">res.currency</field>
        <field name="readonly" eval="True"/>
    </record>
    <record id="stock_move_excise_amount" model="ir.model.fields">
      <field name="compute"><![CDATA[for record in self:
    amount = record.quantity * record.x_currency_id._convert(record.product_id.x_excise_amount, record.product_id.currency_id)
    record['x_excise_amount'] = 0
    if record.x_fiscal_deposit_move == "exit":
        record['x_excise_amount'] = -amount
    elif record.x_fiscal_deposit_move == "entry":
        record['x_excise_amount'] = amount
    ]]></field>
      <field name="ttype">monetary</field>
      <field name="depends">quantity, product_id, x_fiscal_deposit_move</field>
      <field name="field_description">Excise amount</field>
      <field name="model_id" ref="stock.model_stock_move"/>
      <field name="name">x_excise_amount</field>
      <field name="currency_field">x_currency_id</field>
      <field name="readonly" eval="True"/>
    </record>
    <record id="stock_move_excise_category" model="ir.model.fields">
      <field name="ttype">many2one</field>
      <field name="related">product_id.product_tmpl_id.x_excise_category</field>
      <field name="field_description">Excise category</field>
      <field name="model_id" ref="stock.model_stock_move"/>
      <field name="name">x_excise_category</field>
      <field name="readonly" eval="True"/>
      <field name="relation">x_excise_category</field>
    </record>
    <record id="stock_move_excise_quantity" model="ir.model.fields">
      <field name="compute"><![CDATA[for record in self:
    record['x_excise_quantity'] = 0
    if record.x_fiscal_deposit_move and 'exit' in record.x_fiscal_deposit_move:
        record['x_excise_quantity'] = -1 * record.quantity * record.product_id.x_excise_quantity
    elif record.x_fiscal_deposit_move and 'entry' in record.x_fiscal_deposit_move:
        record['x_excise_quantity'] = +1 * record.quantity * record.product_id.x_excise_quantity
]]></field>
      <field name="ttype">float</field>
      <field name="depends">quantity, product_id, x_fiscal_deposit_move</field>
      <field name="field_description">Excise quantity</field>
      <field name="model_id" ref="stock.model_stock_move"/>
      <field name="name">x_excise_quantity</field>
      <field name="readonly" eval="True"/>
    </record>
    <record id="stock_move_excise_amount_unit" model="ir.model.fields">
        <field name="related">x_excise_category.x_unit_id</field>
        <field name="ttype">many2one</field>
        <field name="field_description">Excise Unit</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="depends">x_excise_quantity</field>
        <field name="name">x_excise_unit</field>
        <field name="relation">uom.uom</field>
        <field name="readonly" eval="True"/>
    </record>
     <record id="stock_picking_external_id" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="field_description">External ID</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="name">x_external_id</field>
        <field name="store" eval="True" />
    </record>
    <record id="stock_picking_invoice_ids" model="ir.model.fields">
        <field name="ttype">many2many</field>
        <field name="related">sale_id.invoice_ids</field>
        <field name="field_description">Invoice IDs</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="name">x_invoice_ids</field>
        <field name="readonly" eval="True"/>
        <field name="store" eval="False"/>
        <field name="relation">account.move</field>
    </record>
    <record id="field_sale_order_external_ids" model="ir.model.fields">
        <field name="name">x_external_ids</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="field_description">External IDs</field>
        <field name="ttype">one2many</field>
        <field name="related">picking_ids</field>
        <field name="relation_field">sale_id</field>
        <field name="relation">stock.picking</field>
        <field name="readonly">1</field>
        <field name="store" eval="False" />
    </record>
    <record id="field_account_move_external_ids" model="ir.model.fields">
        <field name="name">x_external_ids</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="field_description">External IDs</field>
        <field name="ttype">one2many</field>
        <field name="related">invoice_line_ids.sale_line_ids.order_id.x_external_ids</field>
        <field name="relation_field">sale_id</field>
        <field name="relation">stock.picking</field>
        <field name="readonly">1</field>
        <field name="store" eval="False" />
    </record>
    <record id="field_account_move_external_ids_count" model="ir.model.fields">
        <field name="compute"><![CDATA[
for record in self: record['x_external_id_count'] = len(record.x_external_ids)
    ]]></field>
        <field name="ttype">integer</field>
        <field name="field_description">External ID count</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="name">x_external_id_count</field>
        <field name="depends">x_external_ids</field>
        <field name="store" eval="False"/>
    </record>
    <record id="stock_move_excise_report" model="ir.model.fields">
        <field name="name">x_excise_report_id</field>
        <field name="ttype">many2one</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="field_description">Excise Report ID</field>
        <field name="relation">x_excise_report</field>
    </record>
    <record id="reporter_id_excise_report" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Reporter ID</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_user_id</field>
        <field name="relation">res.users</field>
    </record>
    <record id="from_date_excise_report" model="ir.model.fields">
        <field name="ttype">date</field>
        <field name="copied" eval="True"/>
        <field name="field_description">From Date</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_from_date</field>
    </record>
    <record id="name_excise_report" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Name</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_name</field>
        <field name="translate">standard</field>
        <field name="depends">x_from_date</field>
        <field name="compute"><![CDATA[
for record in self:
    if record.x_from_date:
        record['x_name'] = f"{str(record.x_from_date.isocalendar()[0])[2:]}W{record.x_from_date.isocalendar()[1]:02d}"
    ]]></field>
    </record>
    <record id="period_excise_report" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="copied" eval="True"/>
        <field name="field_description">Period</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_period</field>
        <field name="depends">x_from_date</field>
        <field name="compute"><![CDATA[
for record in self:
    if record.x_from_date:
        record['x_period'] = f"{(record.x_from_date).strftime('%d/%m/%Y')} - {(record.x_from_date + datetime.timedelta(days=6)).strftime('%d/%m/%Y')}"
    ]]></field>
    </record>
    <record id="external_id_excise_report" model="ir.model.fields">
        <field name="ttype">char</field>
        <field name="copied" eval="True"/>
        <field name="field_description">External ID</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_external_id</field>
    </record>
    <record id="document_excise_report" model="ir.model.fields">
        <field name="ttype">binary</field>
        <field name="field_description">Document</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_document</field>
    </record>
    <record id="state_excise_report" model="ir.model.fields">
        <field name="name">x_state</field>
        <field name="model_id" ref="excise_report" />
        <field name="ttype">selection</field>
        <field name="field_description">State</field>
    </record>
    <record id="state_excise_report_selection_progress" model="ir.model.fields.selection">
        <field name="name">In progress</field>
        <field name="field_id" ref="state_excise_report" />
        <field name="value">progress</field>
    </record>
    <record id="state_excise_report_selection_done" model="ir.model.fields.selection">
        <field name="name">Done</field>
        <field name="field_id" ref="state_excise_report" />
        <field name="value">done</field>
    </record>
    <record id="excise_report_stock_moves" model="ir.model.fields">
        <field name="name">x_stock_move_ids</field>
        <field name="ttype">one2many</field>
        <field name="model_id" ref="excise_report"/>
        <field name="field_description">Stock move IDs</field>
        <field name="relation">stock.move</field>
        <field name="relation_field">x_excise_report_id</field>
        <field name="depends">x_from_date</field>
        <field name="compute"><![CDATA[
for record in self:
    if record.x_from_date:
        record['x_stock_move_ids'] = self.env['stock.move'].search([
            ('date', '>=', record.x_from_date),
            ('date', '<', record.x_from_date + datetime.timedelta(days=7)),
            ('x_excise_category', '!=', False),
            ('x_fiscal_deposit_move', 'not in', ['none', False]),
            ('state', '=', 'done'),
        ]).ids
        ]]></field>
    </record>
    <record id="excise_report_stock_moves_count" model="ir.model.fields">
        <field name="compute"><![CDATA[
for record in self: record['x_move_id_count'] = len(record.x_stock_move_ids)
    ]]></field>
        <field name="ttype">integer</field>
        <field name="field_description">Stock move ID count</field>
        <field name="model_id" ref="excise_report"/>
        <field name="name">x_move_id_count</field>
        <field name="depends">x_stock_move_ids</field>
        <field name="store" eval="False"/>
    </record>
    <record id="excise_report_line_excise_report" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="name">x_excise_report_id</field>
        <field name="field_description">Excise report ID</field>
        <field name="model_id" ref="excise_report_line" />
        <field name="relation">x_excise_report</field>
    </record>
    <record id="excise_report_line_currency_id" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="related">x_excise_report_id.x_stock_move_ids.x_currency_id</field>
        <field name="field_description">Currency</field>
        <field name="model_id" ref="excise_report_line"/>
        <field name="name">x_currency_id</field>
        <field name="readonly" eval="True"/>
        <field name="relation">res.currency</field>
    </record>
    <record id="excise_report_line_excise_category" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="name">x_excise_category_id</field>
        <field name="field_description">Excise Category</field>
        <field name="model_id" ref="excise_report_line" />
        <field name="relation">x_excise_category</field>
    </record>
    <record id="excise_report_line_excise_move_type" model="ir.model.fields">
        <field name="ttype">selection</field>
        <field name="name">x_excise_move_type</field>
        <field name="field_description">Move Type</field>
        <field name="model_id" ref="excise_report_line" />
    </record>
    <record id="excise_report_line_excise_move_type_selection_none" model="ir.model.fields.selection">
        <field name="name">None</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">none</field>
    </record>
    <record id="excise_report_line_excise_move_type_selection_entry" model="ir.model.fields.selection">
        <field name="name">Entry</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">entry</field>
    </record>
    <record id="excise_report_line_excise_move_type_selection_entry_fd" model="ir.model.fields.selection">
        <field name="name">Entry from FD</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">entry fd</field>
    </record>
    <record id="excise_report_line_excise_move_type_selection_entry_exit" model="ir.model.fields.selection">
        <field name="name">Exit</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">exit</field>
    </record>
    <record id="excise_report_line_excise_move_type_selection_exit_fd" model="ir.model.fields.selection">
        <field name="name">Exit to FD</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">exit fd</field>
    </record>
    <record id="excise_report_line_excise_move_type_selection_transfer" model="ir.model.fields.selection">
        <field name="name">Transfer</field>
        <field name="field_id" ref="excise_report_line_excise_move_type" />
        <field name="value">transfer</field>
    </record>
    <record id="excise_report_line_excise_quantity" model="ir.model.fields">
        <field name="ttype">float</field>
        <field name="name">x_excise_quantity</field>
        <field name="field_description">Quantity</field>
        <field name="model_id" ref="excise_report_line" />
    </record>
    <record id="excise_report_line_excise_unit" model="ir.model.fields">
        <field name="ttype">many2one</field>
        <field name="name">x_excise_unit</field>
        <field name="field_description">Unit</field>
        <field name="model_id" ref="excise_report_line" />
        <field name="related">x_excise_category_id.x_unit_id</field>
        <field name="relation">uom.uom</field>
    </record>
    <record id="excise_report_line_excise_amount" model="ir.model.fields">
        <field name="ttype">monetary</field>
        <field name="name">x_excise_amount</field>
        <field name="field_description">Amount</field>
        <field name="model_id" ref="excise_report_line" />
        <field name="store">True</field>
        <field name="currency_field">x_currency_id</field>
    </record>
    <record id="excise_report_excise_report_line" model="ir.model.fields">
        <field name="ttype">one2many</field>
        <field name="name">x_lines_ids</field>
        <field name="field_description">Lines IDs</field>
        <field name="model_id" ref="excise_report" />
        <field name="relation">x_excise_report_line</field>
        <field name="relation_field">x_excise_report_id</field>
        <field name="depends">x_stock_move_ids</field>
        <field name="compute"><![CDATA[
for record in self:
    if record.x_from_date:
        results = self.env['stock.move']._read_group(domain=[
            ('id', 'in', record.x_stock_move_ids.ids),
        ],
        groupby=['x_excise_category', 'x_fiscal_deposit_move'],
        aggregates=['x_excise_quantity:sum', 'x_excise_amount:sum', 'id:recordset'],
        )
        line_vals = []
        for res in results:
            line = self.env['x_excise_report_line'].create({
                'x_excise_category_id': res[0].id if res[0] else False,
                'x_excise_move_type': res[1] or '',
                'x_excise_quantity': res[2] or 0.0,
                'x_excise_amount': res[3] or 0.0,
                })
            line_vals.append(line.id)
        record['x_lines_ids'] = [(6, 0, line_vals)]
            ]]></field>
    </record>
    <record id="res_company_reporter" model="ir.model.fields">
        <field name="name">x_reporter_id</field>
        <field name="ttype">many2one</field>
        <field name="field_description">Reporter</field>
        <field name="model_id" ref="base.model_res_company"/>
        <field name="relation">res.users</field>
    </record>
    <record id="res_config_reporter" model="ir.model.fields">
        <field name="name">x_reporter_id</field>
        <field name="ttype">many2one</field>
        <field name="field_description">Reporter</field>
        <field name="model_id" ref="base.model_res_config_settings"/>
        <field name="relation">res.users</field>
        <field name="related">company_id.x_reporter_id</field>
    </record>
</odoo>
